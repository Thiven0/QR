{
  "info": {
    "name": "QR Backend API",
    "_postman_id": "22f1ee3f-e3a5-4bab-8fe4-7a0f69d76a0e",
    "description": "Coleccion de endpoints alineados con los controladores actuales del backend.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "https://services-virid-three.vercel.app",
      "type": "string",
      "description": "URL del backend desplegado. Para pruebas locales usar http://localhost:3000."
    },
    {
      "key": "authToken",
      "value": "",
      "type": "string"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{authToken}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "login"
              ]
            },
            "description": "Autentica usuarios y devuelve token (visitantes retornan ticket activo).",
            "body": {
              "mode": "raw",
              "raw": "{\"email\":\"usuario@ejemplo.com\",\"password\":\"secreto\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/auth/logout",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "logout"
              ]
            },
            "description": "Cierra sesion y marca estado inactivo.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Issue Token (service)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/token",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "token"
              ]
            },
            "description": "Genera token de servicio con llaves configuradas.",
            "body": {
              "mode": "raw",
              "raw": "{\"access_key\":\"accessKey123\",\"secret_key\":\"secretKey123\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Profile",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/auth/profile",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "profile"
              ]
            },
            "description": "Perfil del usuario autenticado (incluye visitorTicket).",
            "auth": {
              "type": "inherit"
            }
          }
        }
      ]
    },
    {
      "name": "Users",
      "item": [
        {
          "name": "Create User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users"
              ]
            },
            "description": "Crea usuario (Admin/Celador).",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"nombre\":\"Nombre\",\"email\":\"user@example.com\",\"password\":\"secreto\",\"cedula\":\"1234567890\",\"permisoSistema\":\"Usuario\",\"rolAcademico\":\"Estudiante\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "List Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users"
              ],
              "query": [
                {
                  "key": "search",
                  "value": "juan"
                },
                {
                  "key": "permiso",
                  "value": "Usuario"
                },
                {
                  "key": "estado",
                  "value": "activo"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "25"
                },
                {
                  "key": "includeVisitorTicket",
                  "value": "true"
                }
              ]
            },
            "description": "Listado con filtros y paginacion.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Users Summary",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/users/summary",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                "summary"
              ]
            },
            "description": "Resumen estadistico de usuarios.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Update User",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                ":id"
              ]
            },
            "description": "Actualiza usuario (solo Admin).",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"nombre\":\"Nuevo\",\"estado\":\"activo\",\"permisoSistema\":\"Administrador\",\"rolAcademico\":\"Docente\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Delete User",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/users/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                ":id"
              ]
            },
            "description": "Elimina usuario (solo Admin).",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Toggle Access by Cedula",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/toggle-access",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                "toggle-access"
              ]
            },
            "description": "Alterna bloqueado/inactivo por cedula.",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"cedula\":\"1234567890\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Parse Scan",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/parse-scan",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                "parse-scan"
              ]
            },
            "description": "Interpreta texto escaneado.",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"rawText\":\"Nombre\\n1234567890\\nPrograma\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Parse QR",
          "request": {
            "auth": {
              "type": "inherit"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/parse-qr",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                "parse-qr"
              ]
            },
            "description": "Interpreta contenido de un QR y devuelve campos normalizados.",
            "body": {
              "mode": "raw",
              "raw": "{\"qrData\":\"Nombre\\n1234567890\\nPrograma\\nO+\\n3001234567\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Validate Scan",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/validate-scan",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                "validate-scan"
              ]
            },
            "description": "Valida usuario escaneado.",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"cedula\":\"1234567890\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "List Vehicles by User",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/users/:userId/vehicles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                ":userId",
                "vehicles"
              ]
            },
            "description": "Vehiculos del usuario.",
            "auth": {
              "type": "inherit"
            }
          }
        }
      ]
    },
    {
      "name": "Entry & Exit",
      "item": [
        {
          "name": "List Alerts",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/exitEntry/alerts",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "exitEntry",
                "alerts"
              ],
              "query": [
                {
                  "key": "thresholdMinutes",
                  "value": "5"
                }
              ]
            },
            "description": "Alertas por permanencia.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Update Alert Status",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/exitEntry/:id/alert",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "exitEntry",
                ":id",
                "alert"
              ]
            },
            "description": "Actualiza estado de alerta.",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"status\":\"acknowledged\",\"notes\":\"guard reviso\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Create Registro (manual)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/exitEntry",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "exitEntry"
              ]
            },
            "description": "Crea registro manual (Admin/Celador).",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"userId\":\"<id_usuario>\",\"administradorId\":\"<id_admin>\",\"fechaEntrada\":\"2024-11-20T13:00:00.000Z\",\"vehiculoId\":\"<id_vehiculo>\",\"observaciones\":\"Ingreso manual\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "List Registros",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/exitEntry",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "exitEntry"
              ],
              "query": [
                {
                  "key": "rangeDays",
                  "value": "7"
                },
                {
                  "key": "activeOnly",
                  "value": "true"
                },
                {
                  "key": "limit",
                  "value": "100"
                }
              ]
            },
            "description": "Lista registros con filtros.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Get Registro by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/exitEntry/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "exitEntry",
                ":id"
              ]
            },
            "description": "Detalle de registro.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Update Registro",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/exitEntry/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "exitEntry",
                ":id"
              ]
            },
            "description": "Actualiza fechas/observaciones/vehiculo.",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"fechaSalida\":\"2024-11-20T18:00:00.000Z\",\"observaciones\":\"Salida manual\",\"vehiculoId\":\"<id_vehiculo>\",\"alertNotes\":\"\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Delete Registro",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/exitEntry/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "exitEntry",
                ":id"
              ]
            },
            "description": "Elimina registro.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Create Registro From Scan",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/exitEntry/from-scan",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "exitEntry",
                "from-scan"
              ]
            },
            "description": "Crea/cierra registro desde escaneo validado.",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"userId\":\"<id_usuario>\",\"direction\":\"entry\",\"vehicleId\":\"<id_vehiculo>\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Reset Scan Data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/exitEntry/reset-scan",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "exitEntry",
                "reset-scan"
              ]
            },
            "description": "Limpia datos del escaneo actual.",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        }
      ]
    },
    {
      "name": "Visitors",
      "item": [
        {
          "name": "Register Visitor",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/visitors/register",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "visitors",
                "register"
              ]
            },
            "description": "Registra visitante y genera ticket/token.",
            "body": {
              "mode": "raw",
              "raw": "{\"cedula\":\"987654321\",\"nombre\":\"Visitante\",\"apellido\":\"Ejemplo\",\"email\":\"visitante@ejemplo.com\",\"password\":\"clave\",\"documentImage\":\"data:image/jpeg;base64,...\",\"dataConsent\":{\"accepted\":true}}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Extract Visitor Document Data (OCR)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/visitors/ocr",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "visitors",
                "ocr"
              ]
            },
            "description": "Extrae datos de la cedula (OCR).",
            "body": {
              "mode": "raw",
              "raw": "{\"image\":\"data:image/jpeg;base64,...\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Expire Visitor Session",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/visitors/expire",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "visitors",
                "expire"
              ]
            },
            "description": "Visitante expira su ticket.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Reactivate Visitor Ticket",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/visitors/reactivate",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "visitors",
                "reactivate"
              ]
            },
            "description": "Reactiva ticket expirado.",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"userId\":\"<id_visitante>\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "List Visitor Tickets",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/visitors/tickets",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "visitors",
                "tickets"
              ]
            },
            "description": "Tickets de visitantes.",
            "auth": {
              "type": "inherit"
            }
          }
        }
      ]
    },
    {
      "name": "Vehicles",
      "item": [
        {
          "name": "Create Vehicle",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/vehicles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "vehicles"
              ]
            },
            "description": "Crea vehiculo asociado a usuario.",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"owner\":\"<id_usuario>\",\"type\":\"Carro\",\"brand\":\"Mazda\",\"model\":\"3\",\"color\":\"Rojo\",\"plate\":\"ABC123\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "List Vehicles",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/vehicles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "vehicles"
              ]
            },
            "description": "Listado de vehiculos.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Get Vehicle",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/vehicles/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "vehicles",
                ":id"
              ]
            },
            "description": "Detalle de vehiculo.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Update Vehicle",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/vehicles/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "vehicles",
                ":id"
              ]
            },
            "description": "Actualiza vehiculo.",
            "auth": {
              "type": "inherit"
            },
            "body": {
              "mode": "raw",
              "raw": "{\"owner\":\"<id_usuario>\",\"type\":\"Moto\",\"brand\":\"Yamaha\",\"plate\":\"XYZ987\",\"estado\":\"activo\"}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            }
          }
        },
        {
          "name": "Delete Vehicle",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/vehicles/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "vehicles",
                ":id"
              ]
            },
            "description": "Elimina vehiculo.",
            "auth": {
              "type": "inherit"
            }
          }
        },
        {
          "name": "Toggle Vehicle Status",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/vehicles/:id/toggle-status",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "vehicles",
                ":id",
                "toggle-status"
              ]
            },
            "description": "Alterna estado del vehiculo.",
            "auth": {
              "type": "inherit"
            }
          }
        }
      ]
    },
    {
      "name": "Misc",
      "item": [
        {
          "name": "Ruta de Prueba",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/ruta-prueba",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "ruta-prueba"
              ]
            },
            "description": "Endpoint de prueba."
          }
        }
      ]
    }
  ]
}